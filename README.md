# ffmpeg

`07/09/2024`

meu objetivo é estudar como funciona o ffmpeg, tudo que eu preciso saber para fazer um ffmpeg

FUNCAMENTOS DE PROCESSAMENTO DE AUDIO E VIDEO - isso inclui codecs como por exemplo H.264 VP9 AAC, Conteinerer de mídia como MP4 MKV AVI e como que encapsulam fluxos de vaudio e video algo chamado como transcoding que é pra pra converter entre formato de audio e vídeo

BIBLIOTECAS DE MANIPULAÇÃO DE MÍDIA  - como o Libavcoded e o Libavformat - pelo que o gpt falou o ffmpeg é construido em cima dessas lib então é um bom objeto de estudo tambem, GStreamer é outra lib pra manipular midia em tempo real

MANIPUTAÇÃO DE FLUXOS DE VIDEO - Frame by frame processing é como extrair e processar frames de videos como o ffmpeg que trabalha com imagens em sequencia. tem o filtros de video que o ffmpeg supoerta tambem como por exemplo redimensionamento corte e por ai vai

PROTOCOLOS DE STREAMING segundo o gpt tem alguns protocolo pra transmissão ao vivo e sob demanda fundamentais para criar ferramentas de streaming por exemplo RTMP HRL MPEG-DASH assim como Socket pra passar via rede (estudei um pouco sobre socket de barkley e tambem sobre webSocket então talvez eu possa ignorar isso)

ESTRUTURA DE ARQUIVOS E METODOS DE CONVERSAO - Aqui tem Arquitetura de arquivos de mida que é pra entender a estrtura interna dos aqruivos de video e audio como o cabeçalhos metadados e flxuos de bits como funcionam tem tbm essencialmente a cli dele que tem que estudar pra ver como funciona pra tambem implementar se quiser
SISTEMAS DE ARQUIVOS E E/S es é entrada e saida enfim manipulação de arquivos binários é para saber ler e escrever arquivops de midia manipulando bytes diretamente legal acho que isso eu sei fazer +- em C# sei ler e pegar o byte atual que colocar dentro de um buffer modificar o buffer tbm é algo possivel mas ainda n sei manipular objetivamente. buffering e IO de fluxos aqui a gente tem o basicamente oq eu acabei de falar mas te m o  io de fluxo talvez seja interessante olhar... n sei

SINCRONIZAÇÃO DE AUDIO E VIDEO - aqui fala do timestamp e algo chamado pts/dts já n sei oq é, tambem falou da licena e da do C/c++ que o ffmpeg usa mas n sei se é algo que eu vou querer ver não

agora que falei de tudo que o gpt me falou pra agora é interessante focar em alguns pontos que ele me apresentou que seriam os funcamentos de proessamento de video que tambem se categoriza como processamento de  imagem e disso eu lembro que tem um puta de um livro deixa eu ve .... interessante que acabei de sver aqui tem um 
[Grokkin Streaming System](https://www.amazon.com.br/Grokking-Streaming-Systems-Real-Time-Processing/dp/1617297305/ref=sr_1_2?__mk_pt_BR=%C3%85M%C3%85%C5%BD%C3%95%C3%91&sr=8-2&ufe=app_do%3Aamzn1.fos.db68964d-7c0e-4bb2-a95c-e5cb9e32eb12). interessante eu to curtindo bastante oq o meu livrinho de grokkin dsa tem agora esse ai eu tenho certeza que vem coisa boa, mas quem sabe se eu vou pegar pra ler, esse pessoal do grokking tem bastante coisa, olha só falando em bastante coisa enbfim, vamos voltar achei isso aqui pra processamento de video [livro](https://www.amazon.com.br/Multidimensional-Signal-Image-Processing-Coding/dp/0123814200/ref=sr_1_4?__mk_pt_BR=%C3%85M%C3%85%C5%BD%C3%95%C3%91&sr=8-4&ufe=app_do%3Aamzn1.fos.a492fd4a-f54d-4e8d-8c31-35e0a04ce61e). não sei parece que tem uma base matematica muito pesada... pelo que o pessoal ta falando não é pra iniciantes, agora pra processamento de imagem tem esse [livro aqui, PROCESSAMENTO DIGITAL DE IMAGENS](https://www.amazon.com.br/Processamento-digital-imagens-Rafael-Gonzalez/dp/8576054019/ref=sr_1_1?__mk_pt_BR=%C3%85M%C3%85%C5%BD%C3%95%C3%91&sr=8-1&ufe=app_do%3Aamzn1.fos.db68964d-7c0e-4bb2-a95c-e5cb9e32eb12), lembro que tinha graduação pra esse tipo de coisa de tão complexo que é sera que a facens tem??? tem não.
enfim falando mas um poco sobre oq tanto que eu tenho que estudar pra entender como funciona é sobre CODEX principalemente e tambem do Libavcodec e Libavformat

Algo interessante tambem de estudar é como que funciona pro windows mostrar video, mas é algo mais avançado que sai um pouco do escopo mas acabei achando um processamnete de imagem aqui no [microsft learn ](https://learn.microsoft.com/pt-br/windows-hardware/drivers/image/image-processing). mas vou deixa pra dps

puta que pariu falando em microsft learn saba só oq eu achei uqando pesquisei image processing no site deles
https://learn.microsoft.com/pt-br/cpp/parallel/concrt/walkthrough-creating-an-image-processing-network?view=msvc-170 , vou fazer uma pequena review desse artigão gostoso :P
bom vamo la na verdade esse é um documento pra demonstrar como criar uma rede de blocos de mensagens async que processa imagem, ele fala tbm que a rede determina quyais operações executar em uma imagem com base em suas carateristicas ele usa um tal de modelo de dados que é pra ter compoennete independente , mas basicamente é quando um ccompoenente seu reebe mensagem ele executa uma ação e dai passa o resultado pra outro componente isso é um fluxo de controle, if loop essas coisa passa por um fluxo de dados então é uma refe baseada nissa que cria um pipeline de trarefa ou seja um passo a passo de cada trarefa ententão execeuta simultaneamente parte da tarefa geral, é basicamente pra fazer uma linha de raciocinio pra varios ao mesmo tempo enfim tem alguns prerequisitos mas como n faz parte do que eu to estudando vou só ignorar... é... na real os prerequisito são blocos de mensagens async e como usar bloco de pensangem assim como um agente de flkyuxo de dado, mas como eu disse n vou ver...
agora nas seç~~oes ele tem definir funcionalidade de processamento de imagem tem tbm criar a rede de processameno de imagem e um exmeplão.
na sseção de definição de funcionalidade de processamento d eimagem ele mostra como ler im agem no disco? nn na real é funcção de suuporte que a rede de processamento de imagem precisa pra trabalhar com iamagens lidas do disco tem o getRG e makeClor hhumm segundo o código ele pega a color byte r g e b então bytes rgb pra definir o rgb mas olha só que coisa ele fala qget mas na real ele ta agregando na var de r g b pra mim seria um set e ele voltava essas informações ne mas tudo bem que ai ele já faz a atribuição sem gerar mais variaveis ne imagino eu... enfim dado color que é um DWORD que é retornado com make color que basicamente faz um rgb tambem em by sóp que retorna um bute especifico dado left shift 16 no r que seria algo do tipo humm na real é meio chato de usar isso p´q to vendo aqui por exemplo tem 1111 1110 dai << 2 fica 1111 1000 oq parece ter acontecido é que diminuiu o valor que antes era 1111 15 + 1110 que é 14 dai ficou 1000 que é 8 então diminuiu 8 '-' como que <<2 fica -8 bruh, ah não perai tem algo de errado com isso que eu vi fiz em python 1111 << 2 deu 4444, enfim não entendo mt bem, vou pular,
Ah olha que massa tem um processImage que recebe o ponteiro de um bitmap e uma função wtf que porra de código é esse const 
```C++
function<void (DWORD&)>& f
```
eu nem sabia que tinha funciont no C++ ahahahahh enfim aparentemente ele ta usando essa merda ai pra executar uma função que tem como parametro DWORD, se eu n me engano é isso, bom no parallelfor mais pra frente ele de fato tem esse f passando um ponteiro de DOWRD que é o pixel atual então maravilha oq esse código ta fazendo né...
na descrição ele fala que o funciotn transforma o valor de cor de cada pixel em um objeto bitmap GDI+ n sei oq raios é isso mas ta ok até... olha que elgal ele tem um tal de unlockBits que precisa passar por ultimo no bitmap acho que seria algum dispose ou algo do tipo...
seguindo a gente tem umas outras funções pra converter a imagem em escalas de cinza que tbm retorna imagem só que cinza né, humm interessante lembro de ter visto algo assim naquele livro de processamento de imagem... acho que fiz algo assim em python na faculdade foi bem legal, enfim ele faz o nosso process image passando o bitmap normal né e dai executando uma funcção como a gente viu no parametro]
```C++
[](DWORD& color) {
   BYTE r, g, b;
   GetRGB(color, r, g, b);

   // Set each color component to the average of 
   // the original components.
   BYTE c = (static_cast<WORD>(r) + g + b) / 3;
   color = MakeColor(c, c, c);
}
```
olha que doidera de código nem sabia que dava pra passar direto um corpo de função nos parametros mas tudo bem pessoal do c++ tem bastante feature interessante... enfim n entendo mt oq significa []() { talvez seja a sintaxe pra executar uma função anonima dado que o token do nome da função ta no [] deve ser algum hackzin pra função anonima deixa eu confirmar aha achei ta em [anonymous function C++11](https://en.wikipedia.org/wiki/Anonymous_function#C++_(since_C++11)) doidera mas funciona n sei como ahahahahh parece gambiarra mas tabom... continuando ai na função ele define agora 3 BYTE como ele chama pra r g b ele n fala em nenhum momento quando bytes são aparentemente seja um objeto que o pessoal fez pra ficar mais facil controlar isso n sei deixar dinamico de certa forma bom tanto faz dai dps ele faz aquele getRPG que a gente sabe que não é um get mas sim um set kkkkk que seria mais intuitivo em C# saca só 
```C#
private void doRGB(Bitmap mbp, out byte r, out byte g, out byte b) { ... }
```
acho que assim já ficaria bem mais interessante pro josezin da silva que for mexer ou mais facil sem mas com "desperdicio de memoria" sq seria só volta mas enfim continuando....
eles tem um negocio chamado WORD que pega o esses rpg pra dai fazer a cor emsi no make Color que é aquelas operação de bit mt doida, enfim tem um numero bem espeficico pra cada um que por exemplo r1 seria o rgb  393 768 e 189 respectivamente bom sla que merda é essa mas deve ser algo ajustavel e é . então é um decimal enfim ah não poxa tava vendo o sepiatone aaaah é sepia que massa essa função :O gostei bastante então pra deixa a imagem asépia seria essa lógica +- bem doido deve de ter levado mt tempo pra descobri enfim o nosso gray é relaticamente mais tsimples sendo que o byte que usa é unico pra fazer o MakeColor e sim o pessoal da microsoft não usaria make_color como é o certo pra C++, na real o certo é subjetivo cada empresa tem o seu code style... enfim tem um cast pra WORD no r em espeficico ccom soma com g e b pra dai dividir por 3, novamente matemática com magia, sla. 
Olha tem tbm um color maskque faz o color & mask que vc passa que é um DWORD, tbm n sei oq diabo é,  tem um darken aqui que inclui uma porcentagem humm tem só uma dado o factor que ele passa ele multiplica o byte de r g b então interessante do mesmo jeito.
mais pra frente no focumentotemm uma funçlão que determina se naquela imagem qual é a cor dominante né a que mais se repete mas asssim é algo dfificil imagino eu não deveria ser algo facil já q tem tonalidades dai vc teria que decidir qual é o caminho que tu vai tomar , mas enfgim ele usa um combinable que é algo do c++ tbm n vou pesquisar que enfim faz aqlgo qye nb entendo.
Opa acho que cheguei em algo interessante GetEncoderClsid humm Clsid n sei poq seria, com segundo o proprio amigo documentação ele fala que essa funcção recupera o identificador de classe para o tipo mime fornecido de um codificador. humm recupera qual foi o fucking codificador do bitmap :o impressionante, bom vamo ve rapidin
ele tem um WCHAR* pra falar qual é o formato da iamgem talvez? tipo .jpg ou algo do tipo imagino eu, enfim dai tem um CLSID* que poxa n sei oq é n, dai blz tem um objeto chamado imageCodedInfo kkkk claro que tem do nada mas enfim tem outro negocio de set que é get na microsoft que é pra image encoder size dai aquio tem um trickzin com malloc que faz uma desref pro pointer de imagecodec dado o malloc de size então é umma doidera de código que tem chance de gerar um nullprt que é veficiado ne normalmente dai utem um outro get agora pra encoders normal sem ser o size e dai um loop que ai a gente consegue acessar o mimeType da função wcsmp pqp certeza q foi um gordola que n sai de csa que fez isso só ele e o livro que ele escreveu sabe oq dyanh é isso mas enfim tem um freezin no pimageCodedInfo que é aquele malloc doido no loop e dps medo né kk
Maravilha chegando a 30% disso tudo vou começar a acelerar que to começando a perder sanidade...
aqui fala especificamente de jpg ele vai fazer assim ó, converte pra zcinza ve a cor dominante e escureçe e qualquer outro é sétipa nele algo assim, eita aqui o negocio começa a realmente parecer c++ tem uma função que retorna transformer aqui  de wstring , pointer bitmap que tem uma lambda [&] sla que tem um -> mt odoido pra bitmap que dai começa a funcção instancia bitmap e da insert meu amigo vou pula isso auhshusahusau bagulho é tão complexo que tem até um diagrama aqui slk, ah n mas enfim os 50% em diante é o resutlado final que ficou mt interessante mas enfim ficou mt legal o resultado final agora que eu entendi +- como q funciona isso, ele ta usando isso pra mostrar como é possivel alterar as cores da imagem por exemplo tem um aqui mt bonito com uma flor azul e verde que faz meio sepia bem lgeal o mesmo pro pinguim.

é isso sobre a documentação que eu absorvi, nada a ve com oq to vendo KKKKKKKK.
